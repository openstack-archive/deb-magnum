#!/bin/sh

set -e

#PKGOS-INCLUDE#

if [ "$1" = "configure" ] || [ "$1" = "reconfigure" ] ; then
	. /usr/share/debconf/confmodule
	. /usr/share/dbconfig-common/dpkg/postinst

	pkgos_var_user_group magnum

	pkgos_write_new_conf magnum magnum.com
	pkgos_write_new_conf magnum policy.json

	db_get magnum/configure_db
	if [ "$RET" = "true" ]; then
		echo "Now calling magnum-db-manage: this may take a while..."
		su -s /bin/sh -c 'magnum-db-manage --config-file=/etc/magnum/magnum.conf upgrade' magnum
	fi
fi

#DEBHELPER#

exit 0
